# World Constructor. Система построения окружения вокруг планеты газового гиганта

Начинается все с интерфейса, куда игрок вводит параметры системы. Это гравитация планеты с большой массой, количество спутников, количество колец и их свойства. Свойства колец в виде указания баланса между типами вещества в них. Льда и силикатов. А так же степени их минерализации. Указываются станции на орбитах.

Так же игрок выбирает какой мир построить а) сгенерированный б) выбрать предустановленный в) выбрать полет вокруг одного из спутников

С точки зрения структуры системы. Есть `BP_GameInstance`, он создает менеджер экторов `BP_ActorManager`. Функция менеджера регистрировать, хранить и выдавать списки всех экторов созданной сцены. Далее `BP_GameModeBase` определяет будет ли строиться сцена по флагу `bCreateScene`. По команде гейммода запускается создание сцены в BP_GameInstance. Он запускает создание основной планеты с большой массой, спутников, колец и станций. Передает эти экторы менеджеру для регистрации в нем. Так мы всегда можем получить доступ к основной планете, зная, что она основная и к ее спутникам. Так же к каждому из колец и станций на орбитах.

## Какие объекты включает в себя система

### Структуры и дата ассеты

#### Структуры

<!-- temp -->
Решено делать 2 вида данных/структур: Одни(`S_RingProperty`) данные о визуальной составляющей. Хранятся и определяются в дата ассетах DA_. Вторые(`S_Cluster`, `S_Track`) о разметке исп. в конструкторе колец.

- `S_RingProperty` - Содержит данные о кольце. Для конструктора имеет значение параметр "Скорость вращения". Управляющ флаг `SpawnableAsteroids` для дебагинга.
- `S_SpaceBodyProperty` - данные о космическом теле. Класс, Имя, Radius. Применяется в генерации этих параметров для каждого тела созданного генератором. 
- `S_WorldConstructorData` - Собирает установленные пользователем данные из интерфейса конструктора мира `W_WorldSettings` и записывает их в `GameInstance` методом `SetConstructorData`. Там эти данные записываются в отдельные переменные для работы с построением мира.

#### Типы дата ассетов. Типы сеттингов

- `PDA_WorldSettings` - Содержит SEED мира. Содержит количество всех тел(спутников газового гиганта), станций, кораблей, колец в мире.

#### Дата ассеты. Сеттинги

- `DA_DefaultWorldSettings` - Настройки мира, которые должны стартовать в начале каждой сесии и сетапиться в интерфейс конструктора мира `W_WorldSettings`. Это единый дата ассета для установок параметров мира, чтобы было удобно управлять.

### **World Settings widget**

Настраиваются параметры:
- Moon bodies
    - ползунок. количество лун. он создаст примерно порядка 10, 20, 30. Но сколько точно вы не знаете.
- Big Mass body
    - ползунок. гравитационная постоянная тела. это по сути сила гравитации. А определит она в итоге скорость игры.
    - выбрать тип тела.
- Ring map settings
    - список колец. можно добавить или удалить. при добавлении создаются. рандомные параметры кольца.
    - ползунок. пустое расстояние между этим и соседним.
    - ползунок. ширина кольца.
    - ползунок. минерализация в процентах.
    - ползунок. Содержание в виде баланса между льдом и силикатами.
- Orbit Stations
    - Список типов станций-спутников. можно добавить и удалить тип.
    - орбиты должны проходить только между кольцами, внутри или снаружи колец.

### **Game Instance**

- `EventInit` создает Actor Manager и сетапит его.
- `StartWorld` запускает пустой уровень.
- `EventCreateScene` Создает сцену, а именно:

### **Generator / Creator**

Это набор функций Game Instance Object, которые занимаются генерацией объектов мира. 
Создает в заданном порядке:
- `CreateEnvironment` создает свет звезды, свет окружения, создает окружение звезд.
- `CreateBigMassBody` создает главную планету с большой массой (флаг `King`).
- `CreateBodies`  создает спутники этой планеты.
- `CreateRings` создает кольца.
    - Кольцу передает нужную полноту списка данных: текстуры с данными
    - Трекам и кластерам передает нужную полноту списка данных: данные о разметке текстур
- `CreateSpaceStation` создает космические станции.
- `CreateSpaceship` создает корабль игрока.

### **Actor Manager**
- `Registrate`: регистрирует каждый эктор, чтобы предоставлять их другим системам по запросу.
    - спутники `SpaceBodies`, `Moons`.
    - кольца `Ring` and `FarRing`.
    - главную планету `BigMassBody`.
    - корабли игрока `SpaceShips`, и другие станции `SpaceStations`.
    - экторы освещения и окружения `SpaceLight`, `SpaceEnvironment`.
- `StartRings` инициирует запуск систем построения колец.
- `StartSpaceBody` инициирует запуск систем космических тел.
- `StartSpaceShip` инициирует запуск систем корабля игрока.
- `StartSpaceStation` инициирует запуск систем космических станций.
- `ReceiveData` *выдает какие либо данные (общего вида функция). Не помню уже зачем была нужна.*
- `GetStarLight`  выдает DirectLightComponent светильника звезды.
- `GetSpaceLight` выдает освещение космоса - `BP_SpaceLight`.
- `GetSpaceEnvironment` выдает окружение космоса - `BP_StarfieldSpaceSphere`.

### **Function Libraty Visual** (`FL_Visual`)
- `GetBPGameInstance` - выдает наш класс гейминстанса.
- `GetActorManager` - выдает эктор менеджер.

### Несколько **Game modes** 

*в действительности не важно сколько. главное, что гейммод решает использовать построение мира, либо просто загрузить уровень.*

### **SpaceLight**
- освещает сцену директлайтом и скайлайтом.

### **Starfield Space Sphere**
- `ConstructionScript` создает сферу с текстурой, создает изображения звезд, создает изображение звезды системы, *которая светит на сцену при помощи `SpaceLight`*.

### **Ring**
- Создает кольцо

### **FarRing**
- создает дальний вид кольца.
- анимация кругового движения.

### **Asteroid**
- *Функция на будущее. Оперировать отдельными астероидами и их небольшими скоплениями. (Для создания отдельного мусора в космосе)*

## Что не сделано

### Объекты:

- World Settings widget
    - не использует дата ассет `DA_DefaultWorldSettings`
    - Виджет не умеет удалять кольцо из списка. Иными словами кнопка `-` *minus* не работает.
- Ring
    - ~~Не передает~~ передает нужную полноту списка данных: текстуры с данными
- Cluster
    - Трекам и кластерам ~~Не передает~~ передает нужную полноту списка данных: данные о разметке текстур

## Какие остались проблемы

2. Нет генерации параметров (плотность, состав минералов, баланс льда, оптические свойства) по текстуре, чтобы кольца имели красивый структурный вид по концепту. Это материалы, состав, количество вещества. Это про вид `FarRing`. Конструктор мира должен их брать их текстур в пресетах DA и передавать Кольцам. Далее кольца сами. 
Связана с 3.2

3. Созданы структуры: `S_RingProperty`, `S_ClusterProperty`, `S_AsteroidProperty`.
    
    3.0 `S_RingProperty` - Набор старый, нужно удалить лишнее, вставить актуальное. **INPROGRESS**
  
    3.2 Нужно добавить необходимые данные в структуры по ходу решения других проблем (2, 5, !8!, 10). 

5. ~~Не настроена~~ **Настроена** возможность создать предустановленный мир в виде заготовленного левела. Система может такое. 

    5.1 Но в конструкторе нет режима "предустановленный мир". Есть полноценный мир сгенерированный по параметрам. Есть режим "полет вокруг спутника". Нужно, чтобы гейм моду можно было сказать: используй генератор или используй кольца предустановленные на данной карте. Иными словами: а) полноценный мир сгенерированный по параметрам. в) предустановленный мир в виде заготовленного левела. 
        
    Связана с 3.2

6. Так же нет возможности сделать просто лишь дальний вид без генерации. Для превью, например. Или для режима полета вокруг спутника. Там вдали должны быть видны газовый гигант, кольца и другие спутники. В системе есть отдельный эктор кольца для дальнего плана `BP_FarRing`. Нужно запускать `UpdateGrid` in `BP_Ring` чтобы получить данные для `FarRing`. Это можно решить, если сделать генератор кластеров в `GameInstance` Связана с 5 генератор Колец. 

9. Не понятно как корабль будет работать с генератором. Протестировать.
