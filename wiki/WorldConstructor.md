# World Constructor. Система построения окружения вокруг планеты газового гиганта

Начинается все с интерфейса, куда игрок вводит параметры системы. То гравитация планеты с большой массой, количество спутников, количество колец и их свойства. Свойства колец в виде указания баланса между типами вещества в них. Льда и силикатов. А так же степени их минерализации. Указываются станции на орбитах.

Так же игрок выбирает какой мир построить а) сгенерированный б) выбрать предустановленный в) выбрать полет вокруг одного из спутников

С точки зрения структуры системы. Есть `BP_GameInstance`, он создает менеджер экторов `BP_ActorManager`. Функция менеджера регистрировать, хранить и выдавать списки всех экторов созданной сцены. Далее `BP_GameModeBase` определяет будет ли строиться сцена по флагу `bCreateScene`. По команде гейммода запускается создание сцены в BP_GameInstance. Он запускает создание основной планеты с большой массой, спутников, колец и станций. Передает эти экторы менеджеру для регистрации в нем. Так мы всегда можем получить доступ к основной планете, зная, что она основная и к ее спутникам. Так же к каждому из колец и станций на орбитах.

## Какие объекты включает в себя система

### Структуры и дата ассеты

#### Структуры

- `S_RingProperty` - Содержит данные о кольце. Для конструкторя имеет значение параметр "Скорость вращения", управляющ флаг `SpawnableAsteroids` для дебагинга. Набор старый, нужно удалить лишнее, вставить актуальное.
- `S_SpaceBodyProperties` - данные о теле. Класс, Имя, флаг `IsTarget` (цель игрока). Применяется в генерации этих параметров для каждого тела созданного генератором. 
- `S_WorldConstructorData` - Собирает установленные пользователем данные из интерфейса конструктора мира `W_WorldSettings` и записывает их в `GameInstance` методом `SetConstructorData`. Там эти данные записываются в отдельные переменные для работы с построением мира.

#### Типы дата ассетов. Типы сеттингов

- `PDA_WorldSettings` - Содержит SEED мира. Содержит количество всех тел(спутников газового гиганта), станций, кораблей, колец в мире.

#### Дата ассеты. Сеттинги

- `DA_DefaultWorldSettings` - Настройки мира, которые должны стартовать в начале каждой сесии и сетапиться в интерфейс конструктора мира `W_WorldSettings`.

### **World Settings widget**

Настраиваются параметры:
- Moon bodies
    - ползунок. количество лун. он создаст примерно порядка 10, 20, 30. Но сколько точно вы не знаете.
- Big Mass body
    - ползунок. гравитационная постоянная тела. это по сути сила гравитации. А определит она в итоге скорость игры.
    - выбрать тип тела.
- Ring map settings
    - список колец. можно добавить или удалить. при добавлении создаются. рандомные параметры кольца.
    - ползунок. пустое расстояние между этим и соседним.
    - ползунок. ширина кольца.
    - ползунок. минерализация в процентах.
    - ползунок. Содержание в виде баланса между льдом и силикатами.
- Orbit Stations (celestials)
    - Список станций-спутников. можно добавить и удалить.
    - параметры орбиты в виде расстояния. должны проходить только между кольцами, внутри или снаружи колец.

### **Game Instance**

- `EventInit` создает Actor Manager и сетапит его , Создает Generator. 
- `StartWorld` запускает пустой уровень.
- `EventCreateScene` Создает сцену, а именно:

### **Generator / Creator**

Это набор функций Game Instance Object, которые занимаются генерацией объектов мира. 
Создает в заданном порядке:
- `CreateEnvironment` создает свет звезды, свет окружения, создает окружение звезд.
- `CreateBigMassBody` создает главную планету с большой массой (флаг `King`).
- `CreateBodies`  создает спутники этой планеты.
- `CreateRings` создает кольца.
- `CreateCelestials` создает космические станции.
- `CreateSpaceship` создает корабль игрока.

### **Actor Manager**
- `Registrate`: регистрирует каждый эктор, чтобы предоставлять их другим системам по запросу.
    - спутники `SpaceBodies`, `Moons`.
    - кольца `Ring` and `FarRing`.
    - главную планету `BigMassBody`.
    - корабли игрока `Spaceships`, и другие станции `Celestials`.
    - экторы освещения и окружения `SpaceLight`, `SpaceEnvironment`.
- `StartRings` инициирует запуск систем построения колец.
- `StartSpaceBody` инициирует запуск систем космических тел.
- `StartSpaceShip` инициирует запуск систем корабля игрока.
- `StartSpaceStation` инициирует запуск систем космических станций.
- `ReceiveData` *выдает какие либо данные (общего вида функция). Не помню уже зачем была нужна.*
- `GetStarLight`  выдает DirectLightComponent светильника звезды.
- `GetSpaceLight` выдает освещение космоса - `BP_SpaceLight`.
- `GetSpaceEnvironment` выдает окружение космоса - `BP_StarfieldSpaceSphere`.

### **Function Libraty Visual** (`FL_Visual`)
- `GetBPGameInstance` - выдает наш класс гейминстанса.
- `GetActorManager` - выдает эктор менеджер.

### Несколько **Game modes** 

*в действительности не важно сколько. главное, что гейммод решает использовать построение мира, либо просто загрузить уровень.*

### **SpaceLight**
- освещает сцену директлайтом и скайлайтом.

### **Starfield Space Sphere**
- `ConstructionScript` создает сферу с текстурой, создает изображения звезд, создает изображение звезды системы, *которая светит на сцену при помощи `SpaceLight`*.

### **Ring**
- Создает кольцо

### **FarRing**
- создает дальний вид кольца.
- анимация кругового движения.

### **Asteroid**
- *Функция на будущее. Оперировать отдельными астероидами и их небольшими скоплениями. (Для создания отдельного мусора в космосе)*

## Что не сделано

### Объекты:

- World Settings widget
    - станции-спутники Не в виде списка. нельзя добавить и удалить.
    - нет параметров орбиты в виде расстояния. не проходят только между кольцами, внутри или снаружи колец.

## Какие остались проблемы

2. Нет генерации параметров (плотность, состав минералов, баланс льда, оптические свойства) по текстуре, чтобы кольца имели красивый структурный вид по концепту. Это материалы, состав, количество вещества. Это про вид `FarRing`. Конструктор мира должен их брать их текстур в пресетах DA и передавать Кольцам. Далее кольца сами.

3. Созданы структуры: `S_RingProperty`, `S_ClusterProperty`, `S_AsteroidProperty`.
    
    3.0 `S_RingProperty` - Набор старый, нужно удалить лишнее, вставить актуальное.

     <!-- ТУ ДУ - напиши это в описания -->
    3.1 Решено делать 2 вида данных/структур: Одни данные о визуальной составляющей. Хранятся и определяются в дата ассетах DA_. Вторые о разметке исп. в конструкторе колец.

    <!-- ТУ ДУ - напиши это в описания -->
    3.2 ~~Не в полной мере решено~~ Решено куда какие данные надо передать. Какие кольцу - текстуры с данными лучше хранить в них., трекам и кластеру - данные о разметке текстур., астероиду - дублировать состав, чтобы каждый мог генерировать отдельно свой вид. Нужно добавить необходимые по ходу решения других проблем (2, 4, 5, !8!, 10). 

5. ~~Не настроена~~ **Настроена** возможность создать предустановленный мир в виде заготовленного левела. Система может такое но в конструкторе нет режима "предустановленный мир". Есть полноценный мир сгенерированный по параметрам. Есть режим "полет вокруг спутника". Нужно, чтобы гейм моду можно было сказать: используй генератор или используй кольца предустановленные на данной карте.
Иными словами: а) полноценный мир сгенерированный по параметрам. в) предустановленный мир в виде заготовленного левела.

6. Так же нет возможности сделать просто лишь дальний вид без генерации. Для превью, например. Или для режима полета вокруг спутника. Там вдали должны быть видны газовый гигант, кольца и другие спутники. В системе есть отдельный эктор кольца для дальнего плана `BP_FarRing`. 

7. Виджет не умеет удалять кольцо из списка. Иными словами кнопка `-` *minus* не работает.

<!-- ТУ ДУ - напиши это в описания -->
8. ~~Нет~~ Есть единый дата ассета для установок параметров мира, чтобы было удобно управлять. *Сделав это, наверное, придет понимание что я хочу и в каком объеме.* 

9. Не понятно как корабль будет работать с генератором. Протестировать.